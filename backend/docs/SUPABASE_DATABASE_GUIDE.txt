# Supabase Database Guide
## How to Create Tables and Store Data

===========================================
OPTION 1: SUPABASE DASHBOARD (Recommended)
===========================================

1. Go to: https://supabase.com/dashboard
2. Select your project → SQL Editor
3. Run SQL to create tables:

-- Example: Create an interviews table
CREATE TABLE interviews (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title TEXT NOT NULL,
    candidate_email TEXT NOT NULL,
    status TEXT DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now()
);

-- Example: Create questions table with relation
CREATE TABLE interview_questions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    interview_id UUID REFERENCES interviews(id) ON DELETE CASCADE,
    question_text TEXT NOT NULL,
    answer_text TEXT,
    score INTEGER,
    created_at TIMESTAMPTZ DEFAULT now()
);

===========================================
OPTION 2: FROM BACKEND CODE (SQLAlchemy)
===========================================

Step 1: Define models in app/db/models/

# app/db/models/interview.py
from sqlalchemy import Column, String, Text, Integer, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
from app.db.models.base import BaseModel

class Interview(BaseModel):
    __tablename__ = "interviews"
    
    title = Column(String(255), nullable=False)
    candidate_email = Column(String(255), nullable=False)
    status = Column(String(50), default="pending")
    
    # Relationship
    questions = relationship("InterviewQuestion", back_populates="interview")


class InterviewQuestion(BaseModel):
    __tablename__ = "interview_questions"
    
    interview_id = Column(UUID(as_uuid=True), ForeignKey("interviews.id"))
    question_text = Column(Text, nullable=False)
    answer_text = Column(Text)
    score = Column(Integer)
    
    # Relationship
    interview = relationship("Interview", back_populates="questions")

---

Step 2: Create tables (one-time setup)

Add this to app/main.py lifespan or run once:

from app.db.session import get_engine, Base
from app.db.models import *  # Import all models

async def create_tables():
    engine = get_engine()
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

---

Step 3: Store data using services

# app/db/services/interview_service.py
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from app.db.models.interview import Interview, InterviewQuestion

class InterviewService:
    async def create_interview(self, db: AsyncSession, title: str, email: str):
        interview = Interview(title=title, candidate_email=email)
        db.add(interview)
        await db.commit()
        await db.refresh(interview)
        return interview
    
    async def get_interview(self, db: AsyncSession, interview_id):
        result = await db.execute(
            select(Interview).where(Interview.id == interview_id)
        )
        return result.scalar_one_or_none()
    
    async def add_question(self, db: AsyncSession, interview_id, question_text: str):
        question = InterviewQuestion(
            interview_id=interview_id,
            question_text=question_text
        )
        db.add(question)
        await db.commit()
        return question

interview_service = InterviewService()

---

Step 4: Use in routers

# app/routers/interviews.py
from fastapi import APIRouter, Depends
from app.db.session import get_db
from app.db.services.interview_service import interview_service

router = APIRouter(prefix="/interviews", tags=["Interviews"])

@router.post("/")
async def create_interview(title: str, email: str, db = Depends(get_db)):
    return await interview_service.create_interview(db, title, email)

===========================================
QUICK REFERENCE: Common SQLAlchemy Types
===========================================

Column(String(255))          → VARCHAR(255)
Column(Text)                 → TEXT
Column(Integer)              → INTEGER
Column(Boolean)              → BOOLEAN
Column(DateTime)             → TIMESTAMP
Column(UUID(as_uuid=True))   → UUID
Column(ForeignKey("table.id")) → Foreign Key

===========================================
TIP: View your data
===========================================

- Supabase Dashboard → Table Editor
- Or run: SELECT * FROM interviews; in SQL Editor
